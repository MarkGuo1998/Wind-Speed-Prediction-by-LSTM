# LSTM预处理部分

#### 郭嘉明 2018/01/10

##### 一、数据可视化

为较全面地了解数据，我们对数据进行了简单的可视化。首先，我们任取数据集中的一天，分析各个风机处的风速随时间的变化关系，结果如下图。

![风机风速](/Users/MarkGuo/Desktop/course/17-18-1/倒/Wind!/lstm/风机风速.png)

从中可以看出，6个风机处的风速随时间有连续变化的曲线关系。在夜里23-24点和清晨5-6点处，风速达到全天的两个最小值；整个白天中风速均较大，在11-12点处风速达到最大值。风速区间为$[0,15]$，在某些时间处风速测量是间断的。大部分风机处的风速服从相近的函数关系，近似为周期性且与时间相关，我们认为简单的机器学习模型未必能学到这一特征，考虑使用Long-short Term Memory(LSTM)方法。

另外，我们画出了同一天内功率随风速的变化关系。可见，在风机工作未出现错误的前提下，风速和功率正相关。根据推导，风速和风机的功率应呈现三次函数关系，该理论和实际数据大约是符合的。

![功率风速](/Users/MarkGuo/Desktop/course/17-18-1/倒/Wind!/lstm/功率风速.png)

为判断LSTM的输入是否应包含气压和气温的值，我们画出了气压、气温和风速的三维关系，如下图（x轴为气压，y轴为风速，z轴为温度）；但并未发现三者之间有明显的相关关系。考虑到气压和气温是天气预报中预测的数据而并非真实数据，因此我们在模型中抛弃了气压和气温这两个变量，着重研究风速随时间长期的变化情况。![Figure_1](/Users/MarkGuo/Desktop/course/17-18-1/倒/Wind!/lstm/Figure_1.png)

**二、LSTM与预处理**

***LSTM模型的相关信息（略）***

在上述模型中，每个输入的数据点$\boldsymbol X_k​$为一个矩阵$(\boldsymbol t_{k-m}, \boldsymbol t_{k-m+1}, …, \boldsymbol t_{k-1})​$，其对应真值$\boldsymbol y_k​$为一个向量。其中向量$\boldsymbol t_{k-m}, \boldsymbol t_{k-m+1}, …, \boldsymbol t_{k-1}​$分别为第$(k-m), (k-m+1), …, (k-1)​$时刻的数据；这里令$\boldsymbol t_k=(v_{1,k}, v_{2,k}, v_{3,k}, v_{4,k}, v_{5,k}, v_{6,k})^T​$为各个风机在第$k​$时刻的风速数据（当然可以加入各风机在当前时刻的温度、气压等因素，但由于前面的论述，我们决定抛弃这两个变量），由于我们选择的预测标准为15分钟一次，则$\boldsymbol t_k​$为第$k​$个15分钟即第$900k​$秒的数据。

在预处理过程中，我们遇到了一些问题。

首先，原数据中含有真实数据（HisRawData）和预测数据（PredData），训练模型时应当采用哪种风速呢？预测风速未必能准确表征真实风速，真实数据又存在数据质量差、部分观测点间隔大（超过30000秒）、部分月份（4月、7月等）数据严重缺失等问题。为保障结果的准确性，我们还是采用真实风速插值的结果作为$X$和$y$的参考值；在数据质量较差，测量点间距较大的前提下，又只有分段线性插值能保证结果的优良性。

一开始我们尝试先对每一天的数据进行插值，之后再将它们并起来。但由于每天的数据并不是从0秒开始（一般测量起点是第3秒～第7秒），我们无法对0秒插值；同时，又必须取到第0秒的真值用作一个数据点。这启发我们把（所有）4个月的数据合并到一起进行分段线性插值。此时，每天第0秒的数据可以由前一天最后一个测量点和今天第一个测量点进行估计。我们要修改代码，重新划分下标，以对数据做正确的插值。

经插值，我们得到了$T=\{\boldsymbol t_k\}_{k=0}^{121*24*4-1}$这样一个时间序列（长度为11616）。根据LSTM的惯例，取每$\boldsymbol X_k$的列数$m$为60，则有多少个满足条件的$(\boldsymbol X_k, \boldsymbol y_k)$呢？注意到$k\ge m=60$，因此所有可用数据为$S=\{(\boldsymbol X_k, \boldsymbol y_k)\}_{k=60}^{11615}$（共包含11556个数据点）。取训练集大小为10000，测试集大小为1556，二者的比值约为6:1。

上述过程写在`lstm_preprocessing.py`中。